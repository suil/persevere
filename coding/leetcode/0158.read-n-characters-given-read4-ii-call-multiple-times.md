# Read N Characters Given read4 II - Call Multiple Times
[158. Read N Characters Given read4 II - Call Multiple Times](https://leetcode.com/problems/read-n-characters-given-read4-ii-call-multiple-times/)

Given a file and assume that you can only read the file using a given method read4, implement a method read to read n characters. Your method read may be called multiple times.

# Key insights
- Maintain a persistent internal buffer (buf4) with pointers bufPtr and bufCnt across multiple read calls
- Only call read4 when the internal buffer is exhausted (bufPtr === bufCnt); break on EOF (bufCnt === 0)
- Copy from internal buffer to destination buffer until n characters are read or EOF is reached

# Code
```javascript
var solution = function(read4) {
    // Persistent internal buffer across multiple calls
    const buf4 = new Array(4);
    let bufPtr = 0;   // next index to read from buf4
    let bufCnt = 0;   // number of valid chars currently in buf4

    /**
     * @param {character[]} buf Destination buffer
     * @param {number} n Number of characters to read
     * @return {number} The number of actual characters read
     */
    return function(buf, n) {
        let index = 0;

        while (index < n) {
            // If internal buffer is exhausted, refill it
            if (bufPtr === bufCnt) {
                bufCnt = read4(buf4);
                bufPtr = 0;
                if (bufCnt === 0) break; // EOF
            }

            // Copy from internal buffer to destination buffer
            while (index < n && bufPtr < bufCnt) {
                buf[index++] = buf4[bufPtr++];
            }
        }

        return index;
    };
};
```

# Complexity
**Time:** O(n) per call
**Space:** O(1) -- persistent buf4 of size 4
