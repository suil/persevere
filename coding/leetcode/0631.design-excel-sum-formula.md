# Design Excel Sum Formula
[631. Design Excel Sum Formula](https://leetcode.com/problems/design-excel-sum-formula/)

Design the basic function of Excel and implement the function of the sum formula.

# Key insights
- Store cell values and formulas (dependency lists) in separate maps; `set` clears any formula, making the cell a plain value
- `evaluate` recursively resolves formulas by summing the evaluated values of all referenced cells, with memoization via a cache to avoid recomputation
- Range references (e.g., "A1:B3") are expanded into individual cell keys during `sum` setup

# Code
```javascript
/**
 * @param {number} height
 * @param {character} width
 */
var Excel = function(height, width) {
    this.values = new Map();
    this.formulas = new Map();
};

/** 
 * @param {number} row 
 * @param {character} column 
 * @param {number} val
 * @return {void}
 */
Excel.prototype.set = function(row, column, val) {
    const key = `${row}-${column}`;
    this.values.set(key, val);
    this.formulas.delete(key);
};

/** 
 * @param {number} row 
 * @param {character} column
 * @return {number}
 */
Excel.prototype.get = function(row, column) {
    return this.evaluate(`${row}-${column}`, {});
};

Excel.prototype.evaluate = function(key, cache) {
    if (key in cache) return cache[key];

    if (!this.formulas.has(key)) {
        return this.values.get(key) || 0;
    }
    
    let sum = 0;
    for (const cellKey of this.formulas.get(key)) {
        sum += this.evaluate(cellKey, cache);
    }

    cache[key] = sum;
    return sum;
}

/** 
 * @param {number} row 
 * @param {character} column 
 * @param {string[]} numbers
 * @return {number}
 */
Excel.prototype.sum = function(row, column, numbers) {
    function parseRange(number) {
        const [start, end] = number.split(':');
        const [startRow, startCol] = parseCell(start);
        const [endRow, endCol] = parseCell(end);

        const res = [];
        for (let row = startRow; row <= endRow; row++) {
            for (let col = startCol.charCodeAt(0); col <= endCol.charCodeAt(0); col++) {
                res.push(`${row}-${String.fromCharCode(col)}`);
            }
        }
        return res;
    }

    function parseCell(cell) {
        const match = cell.match(/^([A-Z]+)(\d+)$/);
        return [Number(match[2]), match[1]];
    }

    const res = [];
    for (const number of numbers) {
        if (number.includes(':')) {
            const range = parseRange(number);
            res.push(...range);
        } else {
            const [row, col] = parseCell(number);
            res.push(`${row}-${col}`);
        }
    }

    const key = `${row}-${column}`;
    this.formulas.set(key, res);

    return this.evaluate(key, {});
};


/** 
 * Your Excel object will be instantiated and called as such:
 * var obj = new Excel(height, width)
 * obj.set(row,column,val)
 * var param_2 = obj.get(row,column)
 * var param_3 = obj.sum(row,column,numbers)
 */
```

# Complexity
**Time:** O(c) per get/sum call where c is the total number of cells in all dependency chains
**Space:** O(c) -- for storing formulas, values, and the evaluation cache
