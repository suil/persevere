# Pyramid Transition Matrix
[756. Pyramid Transition Matrix](https://leetcode.com/problems/pyramid-transition-matrix/)

You are stacking blocks to form a pyramid. Each block has a color, which is represented by a single letter. Each row of blocks contains one less block than the row beneath it and is centered on top.

# Key insights
- Preprocess allowed triples into a map from adjacent pair to possible top blocks
- Use backtracking to generate all possible next rows from the current row, trying each valid block for each pair
- Recursively build the pyramid level by level until reaching a single block at the top

# Code
```javascript
/**
 * @param {string} bottom
 * @param {string[]} allowed
 * @return {boolean}
 */
var pyramidTransition = function(bottom, allowed) {
    // Build a map from pair (AB) -> list of C
    const map = new Map();
    for (let str of allowed) {
        const key = str.slice(0, 2);
        const val = str[2];
        if (!map.has(key)) {
            map.set(key, []);
        }
        map.get(key).push(val);
    }

    function canBuild(current) {
        if (current.length === 1) return true;

        // calculate nextLevel from current
        function backtrack(index, blocks, output) {
            if (index >= current.length - 1) {
                output.push(blocks);
                return;
            }

            const pair = current.slice(index, index + 2);
            for (const next of map.get(pair) || []) {
                backtrack(index + 1, blocks + next, output);
            }
        }

        const nextLevels = [];
        backtrack(0, '', nextLevels);

        for (const next of nextLevels) {
            if (canBuild(next) === true) return true;
        }
        return false;
    }

    return canBuild(bottom);
};
```

# Complexity
**Time:** O(A^n) in the worst case where A is the max allowed options per pair and n is the row length**Space:** O(n^2) for recursion depth and generated rows
