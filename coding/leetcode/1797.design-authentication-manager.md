# Design Authentication Manager
[1797. Design Authentication Manager](https://leetcode.com/problems/design-authentication-manager/)

There is an authentication system that works with authentication tokens. For each session, the user will receive a new authentication token that will expire timeToLive seconds after the currentTime. If the token is renewed, the expiry time will be extended to expire timeToLive seconds after the (potentially different) currentTime.

# Key insights
- Use Map for O(1) token lookup and storage of expiration times
- Use min-heap (PriorityQueue) to efficiently purge expired tokens
- Purge expired tokens at the start of each operation based on currentTime
- Renew updates expiration time and re-inserts into the priority queue

# Code
```javascript
/**
 * @param {number} timeToLive
 */
var AuthenticationManager = function(timeToLive) {
    this.map = new Map();
    this.queue = new PriorityQueue((a, b) => a.expireTime - b.expireTime);
    this.timeToLive = timeToLive;
};

AuthenticationManager.prototype._purge = function(currentTime) {
    while (!this.queue.isEmpty() && this.queue.front().expireTime <= currentTime) {
        const { tokenId } = this.queue.pop();
        this.map.delete(tokenId);
    }
}

/** 
 * @param {string} tokenId 
 * @param {number} currentTime
 * @return {void}
 */
AuthenticationManager.prototype.generate = function(tokenId, currentTime) {
    this._purge(currentTime);
    // if (this.map.has(tokenId)) return;
    const expireTime = currentTime + this.timeToLive;
    this.map.set(tokenId, expireTime);
    this.queue.push({ tokenId, expireTime });
};

/** 
 * @param {string} tokenId 
 * @param {number} currentTime
 * @return {void}
 */
AuthenticationManager.prototype.renew = function(tokenId, currentTime) {
    this._purge(currentTime);
    if (!this.map.has(tokenId)) { return }
    const newExpireTime = currentTime + this.timeToLive;
    this.map.set(tokenId, newExpireTime);
    this.queue.remove(a => a.tokenId === tokenId);
    this.queue.push({ tokenId, expireTime: newExpireTime });
};

/** 
 * @param {number} currentTime
 * @return {number}
 */
AuthenticationManager.prototype.countUnexpiredTokens = function(currentTime) {
    this._purge(currentTime);
    return this.map.size;
};

/** 
 * Your AuthenticationManager object will be instantiated and called as such:
 * var obj = new AuthenticationManager(timeToLive)
 * obj.generate(tokenId,currentTime)
 * obj.renew(tokenId,currentTime)
 * var param_3 = obj.countUnexpiredTokens(currentTime)
 */
```

# Complexity
**Time:** O(log n) for generate/renew (heap operations), O(1) amortized for countUnexpired
**Space:** O(n) - storing n tokens in map and priority queue
