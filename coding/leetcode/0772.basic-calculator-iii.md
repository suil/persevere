# Basic Calculator III
[772. Basic Calculator III](https://leetcode.com/problems/basic-calculator-iii/)

Implement a basic calculator to evaluate a simple expression string.

# Key insights
- Use a stack to handle operator precedence: push values for +/-, immediately compute for *//
- Handle parentheses by saving current stack and operator context onto a separate ops stack, then restoring on ')'
- On closing parenthesis, reduce the inner stack to a single number and treat it as the operand for the saved operator

# Code
```javascript
var calculate = function(s) {
    let num = 0, prevOp = '+';
    let stack = [];
    const ops = [];
    s = s.replace(/\s+/g, ''); // remove spaces
    let i = 0;

    for (let i = 0; i <= s.length; i++) {
        let char = s[i] || ''; // To handle last number

        if (/\d/.test(char)) {
            num = num * 10 + Number(char);
        }

        if (['+', '-', '*', '/', ')'].includes(char) || i === s.length) {
            if (prevOp === '+') {
                stack.push(num);
            } else if (prevOp === '-') {
                stack.push(-num);
            } else if (prevOp === '*') {
                stack.push(stack.pop() * num);
            } else if (prevOp === '/') {
                stack.push(Math.trunc(stack.pop() / num));
            }
            num = 0;
            prevOp = char;
        }

        if (char === '(') {
            // Push context
            ops.push([...stack]);
            ops.push(prevOp);
            stack = [];
            prevOp = '+';
            num = 0;
        }

        if (char === ')') {
            // Complete evaluation inside the parenthesis
            num = stack.reduce((a, b) => a + b, 0);
            prevOp = ops.pop();
            const prevStack = ops.pop();
            stack = [...prevStack];
        }
    }

    return stack.reduce((a, b) => a + b, 0);
};
```

# Complexity
**Time:** O(n) where n is the expression length**Space:** O(n) for the stack and ops stack
